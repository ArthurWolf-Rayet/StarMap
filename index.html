<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Padua Redemption: Triangulation</title>
<style>
:root{
  /* Sci-fi palette */
  --bg0:#05070c; --bg1:#070b12;
  --panel: rgba(10, 16, 26, 0.72);
  --border: rgba(110, 240, 255, 0.22);
  --text: rgba(235, 250, 255, 0.92);
  --muted: rgba(235, 250, 255, 0.62);
  --cyan: rgba(110, 240, 255, 0.95);
  --purple: rgba(180, 120, 255, 0.95);
  --good: rgba(120, 255, 200, 0.95);
  --bad: rgba(255, 120, 140, 0.95);
}

*{box-sizing:border-box}
html, body { height: 100%; }
body{
  margin:0; min-height:100vh;
  display:grid; place-items:center; padding:28px;
  color:var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;
  background:
    radial-gradient(1200px 700px at 20% 15%, rgba(110,240,255,0.12), transparent 55%),
    radial-gradient(1000px 650px at 80% 30%, rgba(180,120,255,0.10), transparent 60%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
  overflow-x:hidden;
}

/* Base Styles */
.wrap{width:min(1040px,100%); text-align:center;}
h1{
  margin: 0 0 16px;
  font-size: clamp(30px, 4.4vw, 52px);
  letter-spacing: .12em;
  text-transform: uppercase;
  font-weight: 800;
  text-shadow: 0 0 18px rgba(110,240,255,0.18);
}

.card{
  background: linear-gradient(180deg, rgba(10,16,26,0.78), rgba(7,10,16,0.72));
  border: 1px solid rgba(110,240,255,0.18);
  border-radius: 18px;
  box-shadow: 0 18px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(180,120,255,0.10) inset;
  padding: 18px;
  text-align:left;
  position:relative;
}

/* Top Bar Pills */
.topbar{
  display:flex; gap:12px; flex-wrap:wrap;
  align-items:stretch; justify-content:space-between;
  margin-bottom:12px;
}
.pill{
  flex:1 1 280px;
  background: linear-gradient(180deg, rgba(10,16,26,0.70), rgba(8,12,20,0.62));
  border: 1px solid rgba(110,240,255,0.16);
  border-radius: 16px;
  padding: 12px 14px;
  min-height: 72px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  box-shadow: 0 0 0 1px rgba(180,120,255,0.08) inset;
}
.sub{ color: var(--muted); font-size: 13px; margin-top:4px; line-height: 1.3; }
.strong-title { display:block; font-weight:700; color:var(--text); letter-spacing:.05em; }

/* TRIANGULATION STYLES */
.triangle-wrap {
    position: relative;
    width: 60px;
    height: 52px; 
    margin-right: 10px;
}

.circle {
    width: 14px; height: 14px;
    border: 2px solid var(--cyan);
    border-radius: 50%;
    background: var(--bg0);
    position: absolute;
    z-index: 2;
    transition: all 0.4s ease;
    box-shadow: 0 0 5px rgba(110,240,255,0.2);
}

/* Positioning Circles */
.c-top { top: 0; left: 50%; transform: translateX(-50%); }
.c-right { bottom: 0; right: 0; }
.c-left { bottom: 0; left: 0; }

.circle.lit {
    background: var(--cyan);
    box-shadow: 0 0 12px var(--cyan);
    border-color: #fff;
}

/* Connecting Lines */
.line {
    position: absolute;
    background: var(--cyan);
    height: 2px;
    opacity: 0;
    transform-origin: top left;
    transition: opacity 0.5s ease;
    z-index: 1;
    box-shadow: 0 0 4px var(--cyan);
}
.line.show { opacity: 1; }

/* Line Geometry */
.l-1 { width: 34px; top: 7px; left: 30px; transform: rotate(60deg); }
.l-2 { width: 44px; top: 48px; left: 47px; transform: rotate(180deg); } 
.l-3 { width: 34px; top: 45px; left: 6px; transform: rotate(300deg); }

/* Main Grid */
.grid{
  display:grid; grid-template-columns: 1fr 1fr; gap:12px;
  position:relative; z-index:1;
}
@media (max-width: 800px){ .grid{grid-template-columns:1fr;} }

.panel{
  background: linear-gradient(180deg, rgba(10,16,26,0.72), rgba(8,12,20,0.64));
  border: 1px solid rgba(110,240,255,0.15);
  border-radius: 18px;
  padding: 14px;
  display:flex; flex-direction:column;
}

.label{
  font-size: 12px; letter-spacing:.22em; text-transform:uppercase;
  color: rgba(235,250,255,0.70); margin:0 0 10px;
}

/* Display Windows */
.display-window {
  border: 1px solid rgba(110,240,255,0.16);
  border-radius: 16px;
  background: radial-gradient(circle at center, rgba(110,240,255,0.05), transparent 70%);
  height: 400px;
  width: 100%;
  position: relative;
  overflow: hidden;
  box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
}

.display-window img {
    width: 100%; height: 100%;
    object-fit: contain;
    opacity: 0.9;
    mix-blend-mode: screen;
}

/* Focus Animation for Slewing (Optical) */
@keyframes mechanicalFocus {
  0% { filter: blur(0px) brightness(1); transform: scale(1); }
  20% { filter: blur(6px) brightness(1.5); transform: scale(1.02); }
  40% { filter: blur(2px) brightness(0.8); }
  60% { filter: blur(4px) brightness(1.2); }
  100% { filter: blur(0px) brightness(1); transform: scale(1); }
}
.re-focus img { animation: mechanicalFocus 0.8s steps(5, end); }

/* Scan Animation for Archive */
@keyframes scanGlitch {
  0% { opacity: 0.5; transform: translateY(-5px); }
  50% { opacity: 1; transform: translateY(0); }
  100% { opacity: 0.9; }
}
.re-scan img { animation: scanGlitch 0.3s ease-out; }


/* Buttons */
button{
  border: 1px solid rgba(110,240,255,0.18);
  background: linear-gradient(180deg, rgba(18,28,44,0.75), rgba(8,12,20,0.70));
  color: var(--text);
  padding: 10px 18px;
  border-radius: 999px;
  cursor:pointer;
  font-weight: 750;
  text-transform: uppercase;
  font-size: 12px;
  transition: all .2s ease;
  box-shadow: 0 0 0 1px rgba(180,120,255,0.06) inset;
}
button:hover{ filter: brightness(1.2); border-color:var(--cyan); }
button:active{ transform: scale(.96); }

.btn-gen { background: rgba(110,240,255,0.1); width: 100%; margin-top: 10px; }
.btn-row { display: flex; gap: 10px; margin-top: 12px; }
.btn-match { flex: 1; border-color: var(--good); color: var(--good); }
.btn-no-match { flex: 1; border-color: var(--bad); color: var(--bad); }

.btn-encode {
    background: var(--purple); color: #000; border: 1px solid #fff;
    box-shadow: 0 0 20px var(--purple); animation: pulse 2s infinite;
}

#feedbackMsg { font-weight: bold; color: var(--cyan); }
.hex-display {
    font-family: ui-monospace, monospace; font-size: 18px;
    color: var(--good); margin-top: 8px; letter-spacing: 0.1em;
}

@keyframes pulse { 50% { box-shadow: 0 0 5px var(--purple); } }

.footerNote{
  margin-top:10px; font-size:12px; color: rgba(235,250,255,0.55);
  text-align:center; letter-spacing:.08em; text-transform: uppercase;
}
</style>
</head>

<body> 
<div class="wrap"> 
<h1>Padua Redemption</h1>

<div class="card">
  <div class="topbar">
    
    <div class="pill">
      <div>
        <span class="strong-title">Nav Computation</span>
        <div class="sub">Match Current Optical Sensor Display to the Imaging from the Archive</div>
      </div>
    </div>

    <div class="pill">
      <div>
        <span class="strong-title">Triangulation</span>
        <div class="sub">Direction Finding Accuracy</div>
      </div>
      <div class="triangle-wrap">
          <div class="line l-1" id="line1"></div> 
          <div class="line l-2" id="line2"></div> 
          <div class="line l-3" id="line3"></div> 
          
          <div class="circle c-top" id="c1"></div>
          <div class="circle c-right" id="c2"></div>
          <div class="circle c-left" id="c3"></div>
      </div>
    </div>

    <div class="pill">
      <div>
        <span class="strong-title">System Feedback</span>
        <div class="sub" id="feedbackMsg">System Idle...</div>
        <div id="hexResult" class="hex-display"></div>
      </div>
      <div id="actionArea"></div>
    </div>
  </div>

  <div class="grid">
    
    <div class="panel">
      <div class="label">Optical Sensor Display</div>
      <div class="display-window" id="scopeWrap">
        <img id="imgQ" src="" alt="No Signal" style="display:none;">
      </div>
      <button class="btn-gen" id="btnGen">Slew Optical Sensor</button>
    </div>

    <div class="panel">
      <div class="label">NavLog Archive</div>
      <div class="display-window" id="archiveWrap">
        <img id="imgA" src="" alt="No Data" style="display:none;">
      </div>
      <div class="btn-row" id="controls">
        <button class="btn-match" id="btnMatch">Match Confirmed</button>
        <button class="btn-no-match" id="btnNoMatch">No Match</button>
      </div>
    </div>

  </div>

  <div class="footerNote">Anvil Optical Telemetry â€¢ v14.2938.11b</div>
</div>
</div> 

<script>
/**
 * PADUA REDEMPTION: TRIANGULATION MODULE
 */

// State
let score = 0; 
let qFiles = [];
let aFiles = [];
let currentQ = "";
let currentA = "";
let isGameActive = true;

// DOM Elements
const elImgQ = document.getElementById('imgQ');
const elScope = document.getElementById('scopeWrap'); 
const elImgA = document.getElementById('imgA');
const elArchive = document.getElementById('archiveWrap');
const elFeedback = document.getElementById('feedbackMsg');
const elHex = document.getElementById('hexResult');
const elActionArea = document.getElementById('actionArea');

const nodes = [document.getElementById('c1'), document.getElementById('c2'), document.getElementById('c3')];
const lines = [document.getElementById('line1'), document.getElementById('line2'), document.getElementById('line3')];

// --- Initialization ---
async function init() {
    try {
        const qRes = await fetch('Q.txt');
        const aRes = await fetch('A.txt');
        if(qRes.ok && aRes.ok) {
            const qText = await qRes.text();
            const aText = await aRes.text();
            qFiles = qText.split('\n').map(s => s.trim()).filter(s => s);
            aFiles = aText.split('\n').map(s => s.trim()).filter(s => s);
        } else { throw new Error("Files not found"); }
    } catch (e) {
        console.warn("Using fallback mock data (Text files not found)");
        qFiles = ["star(1).png", "star(2).png", "star(3).png", "star(4).png"];
        aFiles = ["nav(1).jpg", "nav(2).jpg", "nav(9).jpg", "nav(3).jpg"];
    }
    // Start with a full random set
    updateImages('BOTH'); 
}

function getID(filename) {
    if(!filename) return -999;
    const match = filename.match(/\((\d+)\)/);
    return match ? parseInt(match[1]) : -1;
}

/**
 * Update Images Logic
 * mode = 'BOTH':   Changes Q AND A. (Used for Match Confirmed / Init)
 * mode = 'Q_ONLY': Changes Q only. Keeps A. (Used for Slew)
 * mode = 'A_ONLY': Changes A only. Keeps Q. (Used for No Match)
 */
function updateImages(mode) {
    if(!isGameActive) return;
    if (qFiles.length === 0 || aFiles.length === 0) return;

    // 1. Update Optical Sensor (Q)
    // Only if mode is BOTH or Q_ONLY
    if(mode === 'BOTH' || mode === 'Q_ONLY') {
        const randQ = Math.floor(Math.random() * qFiles.length);
        currentQ = qFiles[randQ];
        elImgQ.src = currentQ;
        elImgQ.style.display = "block";
        
        // Focus Animation for Optical
        elScope.classList.remove('re-focus');
        void elScope.offsetWidth; 
        elScope.classList.add('re-focus');

        elImgQ.onerror = () => { elImgQ.src = "https://placehold.co/1080x1920/000000/113344?text=" + currentQ; };
    }

    // 2. Update NavLog (A)
    // Only if mode is BOTH or A_ONLY
    if(mode === 'BOTH' || mode === 'A_ONLY') {
        // 25% chance to force a match if one exists
        const targetID = getID(currentQ);
        const matchingA = aFiles.find(f => getID(f) === targetID);
        
        let pickedA;
        // Randomly decide if we show the match (if available) or random junk
        if (matchingA && Math.random() < 0.25) {
            pickedA = matchingA;
        } else {
            pickedA = aFiles[Math.floor(Math.random() * aFiles.length)];
        }

        currentA = pickedA;
        elImgA.src = currentA;
        elImgA.style.display = "block";
        
        // Scan Animation for Archive
        elArchive.classList.remove('re-scan');
        void elArchive.offsetWidth; 
        elArchive.classList.add('re-scan');

        elImgA.onerror = () => { elImgA.src = "https://placehold.co/1080x1920/001122/443355?text=" + currentA; };
    }
    
    // Reset Text Color
    elFeedback.style.color = "var(--cyan)";
}

// Score Logic
function updateScore(change) {
    if(!isGameActive) return;

    let prevScore = score;
    score += change;
    if (score < 0) score = 0;
    if (score > 3) score = 3;

    nodes.forEach((n, i) => {
        if(i < score) n.classList.add('lit');
        else n.classList.remove('lit');
    });

    lines[0].classList.toggle('show', score >= 2); 
    lines[1].classList.toggle('show', score >= 3); 
    lines[2].classList.toggle('show', score >= 3); 

    if (score === 3 && prevScore !== 3) {
        triggerWin();
    }
}

function triggerWin() {
    isGameActive = false;
    elFeedback.textContent = "TRIANGULATION COMPLETE";
    elFeedback.style.color = "var(--good)";
    
    const btn = document.createElement('button');
    btn.className = "btn-encode";
    btn.textContent = "ENCODE SEQUENCE";
    btn.onclick = generateHex;
    elActionArea.appendChild(btn);

    document.getElementById('btnGen').disabled = true;
    document.getElementById('btnMatch').disabled = true;
    document.getElementById('btnNoMatch').disabled = true;
}

function generateHex() {
    const target = 27;
    let n1 = Math.floor(Math.random() * 20) + 1;
    let rem = target - n1;
    if(rem < 1) { n1 = 15; rem = 12; }
    let n2 = Math.floor(Math.random() * (rem - 1)) + 1;
    let n3 = target - n1 - n2;

    const h1 = "0x" + n1.toString(16).toUpperCase();
    const h2 = "0x" + n2.toString(16).toUpperCase();
    const h3 = "0x" + n3.toString(16).toUpperCase();

    elHex.innerHTML = `${h1} &nbsp; ${h2} &nbsp; ${h3}`;
    elActionArea.innerHTML = "";
    elFeedback.textContent = "COORDINATES LOCKED";
}

// --- Event Listeners ---

// SLEW: Changes Q only. Keeps A the same.
document.getElementById('btnGen').addEventListener('click', () => {
    elFeedback.textContent = "Slewing Sensor Array...";
    updateImages('Q_ONLY'); 
});

// MATCH: Checks match, then swaps BOTH images
document.getElementById('btnMatch').addEventListener('click', () => {
    if(!isGameActive) return;
    
    const idQ = getID(currentQ);
    const idA = getID(currentA);

    if (idQ !== -1 && idQ === idA) {
        elFeedback.textContent = "MATCH CONFIRMED (+1)";
        elFeedback.style.color = "var(--good)";
        updateScore(1);
    } else {
        elFeedback.textContent = "MISMATCH DETECTED (-1)";
        elFeedback.style.color = "var(--bad)";
        updateScore(-1);
    }
    
    // Swap BOTH images (New Round)
    setTimeout(() => { if(isGameActive) updateImages('BOTH'); }, 500);
});

// NO MATCH: Checks logic, then swaps A ONLY (Search)
document.getElementById('btnNoMatch').addEventListener('click', () => {
    if(!isGameActive) return;

    const idQ = getID(currentQ);
    const idA = getID(currentA);
    
    if (idQ !== -1 && idQ === idA) {
        // User said No Match, but there WAS a match
        elFeedback.textContent = "ERROR: IGNORED MATCH (-1)";
        elFeedback.style.color = "var(--bad)";
        updateScore(-1);
    } else {
        // User was correct
        elFeedback.textContent = "Scanning Archive...";
    }
    
    // Swap A ONLY (Search Archive)
    setTimeout(() => { if(isGameActive) updateImages('A_ONLY'); }, 200);
});

init();
</script>
</body>
</html>
