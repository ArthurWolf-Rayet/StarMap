<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Padua Redemption: Nav Comp</title>
<style>
:root{
  /* Sci-fi palette */
  --bg0:#05070c; --bg1:#070b12;
  --panel: rgba(10, 16, 26, 0.72);
  --border: rgba(110, 240, 255, 0.22);
  --text: rgba(235, 250, 255, 0.92);
  --muted: rgba(235, 250, 255, 0.62);
  --cyan: rgba(110, 240, 255, 0.95);
  --purple: rgba(180, 120, 255, 0.95);
  --good: rgba(120, 255, 200, 0.95);
  --bad: rgba(255, 120, 140, 0.95);
}

*{box-sizing:border-box}
html, body { height: 100%; }
body{
  margin:0; min-height:100vh;
  display:grid; place-items:center; padding:28px;
  color:var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;
  background:
    radial-gradient(1200px 700px at 20% 15%, rgba(110,240,255,0.12), transparent 55%),
    radial-gradient(1000px 650px at 80% 30%, rgba(180,120,255,0.10), transparent 60%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
  overflow-x:hidden;
}

/* Base Styles & Grid */
.wrap{width:min(1040px,100%); text-align:center;}
h1{
  margin: 0 0 16px;
  font-size: clamp(30px, 4.4vw, 52px);
  letter-spacing: .12em;
  text-transform: uppercase;
  font-weight: 800;
  text-shadow: 0 0 18px rgba(110,240,255,0.18);
}

.card{
  background: linear-gradient(180deg, rgba(10,16,26,0.78), rgba(7,10,16,0.72));
  border: 1px solid rgba(110,240,255,0.18);
  border-radius: 18px;
  box-shadow: 0 18px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(180,120,255,0.10) inset;
  padding: 18px;
  text-align:left;
  position:relative;
}

/* Top Bar Pills */
.topbar{
  display:flex; gap:12px; flex-wrap:wrap;
  align-items:stretch; justify-content:space-between;
  margin-bottom:12px;
}
.pill{
  flex:1 1 280px;
  background: linear-gradient(180deg, rgba(10,16,26,0.70), rgba(8,12,20,0.62));
  border: 1px solid rgba(110,240,255,0.16);
  border-radius: 16px;
  padding: 12px 14px;
  min-height: 72px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  box-shadow: 0 0 0 1px rgba(180,120,255,0.08) inset;
}
.sub{ color: var(--muted); font-size: 13px; margin-top:4px; }
.strong-title { display:block; font-weight:700; color:var(--text); letter-spacing:.05em; }

/* Stability Circles */
.circles-container {
    display: flex;
    gap: 12px;
}
.circle {
    width: 24px;
    height: 24px;
    border: 2px solid var(--cyan);
    border-radius: 50%;
    background: transparent;
    box-shadow: 0 0 8px rgba(110,240,255,0.2);
    transition: all 0.4s ease;
}
.circle.lit {
    background: var(--cyan);
    box-shadow: 0 0 18px var(--cyan);
    border-color: #fff;
}

/* Main Grid Areas */
.grid{
  display:grid; grid-template-columns: 1fr 1fr; gap:12px;
  position:relative; z-index:1;
}
@media (max-width: 800px){ .grid{grid-template-columns:1fr;} }

.panel{
  background: linear-gradient(180deg, rgba(10,16,26,0.72), rgba(8,12,20,0.64));
  border: 1px solid rgba(110,240,255,0.15);
  border-radius: 18px;
  padding: 14px;
  display:flex; flex-direction:column;
}

.label{
  font-size: 12px; letter-spacing:.22em; text-transform:uppercase;
  color: rgba(235,250,255,0.70); margin:0 0 10px;
}

/* Image Containers (Scope & Archive) */
.display-window {
  border: 1px solid rgba(110,240,255,0.16);
  border-radius: 16px;
  background: radial-gradient(circle at center, rgba(110,240,255,0.05), transparent 70%);
  height: 400px;
  width: 100%;
  position: relative;
  overflow: hidden;
  box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
}

.display-window img {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Keeps 1080x1920 ratio inside box */
    opacity: 0.9;
    mix-blend-mode: screen;
}

/* Buttons */
button{
  border: 1px solid rgba(110,240,255,0.18);
  background: linear-gradient(180deg, rgba(18,28,44,0.75), rgba(8,12,20,0.70));
  color: var(--text);
  padding: 10px 18px;
  border-radius: 999px;
  cursor:pointer;
  font-weight: 750;
  text-transform: uppercase;
  font-size: 12px;
  transition: all .2s ease;
  box-shadow: 0 0 0 1px rgba(180,120,255,0.06) inset;
}
button:hover{ filter: brightness(1.2); border-color:var(--cyan); }
button:active{ transform: scale(.96); }

/* Specific Button Styles */
.btn-gen { 
    background: rgba(110,240,255,0.1); 
    width: 100%; 
    margin-top: 10px;
}
.btn-row {
    display: flex; gap: 10px; margin-top: 12px;
}
.btn-match { flex: 1; border-color: var(--good); color: var(--good); }
.btn-no-match { flex: 1; border-color: var(--bad); color: var(--bad); }

.btn-encode {
    background: var(--purple);
    color: #000;
    border: 1px solid #fff;
    box-shadow: 0 0 20px var(--purple);
    animation: pulse 2s infinite;
}

/* Text Feedback Styles */
#feedbackMsg { font-weight: bold; color: var(--cyan); }
.hex-display {
    font-family: ui-monospace, monospace;
    font-size: 18px;
    color: var(--good);
    margin-top: 8px;
    letter-spacing: 0.1em;
}

@keyframes pulse { 50% { box-shadow: 0 0 5px var(--purple); } }

.footerNote{
  margin-top:10px; font-size:12px; color: rgba(235,250,255,0.55);
  text-align:center; letter-spacing:.08em; text-transform: uppercase;
}
</style>
</head>

<body> 
<div class="wrap"> 
<h1>Padua Redemption</h1>

<div class="card">
  <div class="topbar">
    <div class="pill">
      <div>
        <span class="strong-title">Nav Computation</span>
        <div class="sub">Match star formations to sensor</div>
      </div>
    </div>

    <div class="pill">
      <div>
        <span class="strong-title">Stability Window</span>
        <div class="sub">Lock signal integrity</div>
      </div>
      <div class="circles-container">
          <div class="circle" id="c1"></div>
          <div class="circle" id="c2"></div>
          <div class="circle" id="c3"></div>
      </div>
    </div>

    <div class="pill">
      <div>
        <span class="strong-title">System Feedback</span>
        <div class="sub" id="feedbackMsg">Awaiting Input...</div>
        <div id="hexResult" class="hex-display"></div>
      </div>
      <div id="actionArea">
         </div>
    </div>
  </div>

  <div class="grid">
    
    <div class="panel">
      <div class="label">Optical Sensor Display</div>
      <div class="display-window" id="scopeWrap">
        <img id="imgQ" src="" alt="No Signal" style="display:none;">
      </div>
      
      <button class="btn-gen" id="btnGen">Generate New Sensor Data</button>
    </div>

    <div class="panel">
      <div class="label">NavLog Archive</div>
      <div class="display-window">
        <img id="imgA" src="" alt="No Data" style="display:none;">
      </div>

      <div class="btn-row" id="controls">
        <button class="btn-match" id="btnMatch">Match Confirmed</button>
        <button class="btn-no-match" id="btnNoMatch">No Match</button>
      </div>
    </div>

  </div>

  <div class="footerNote">Padua Deep-Space Array â€¢ Xeno-Signal Stabilization Module</div>
</div>
</div> 

<script>
/**
 * PADUA REDEMPTION: NAV COMP LOGIC
 */

// State
let score = 0; // 0 to 3
let qFiles = [];
let aFiles = [];
let currentQ = "";
let currentA = "";
let isGameActive = true;

// DOM Elements
const elImgQ = document.getElementById('imgQ');
const elImgA = document.getElementById('imgA');
const elFeedback = document.getElementById('feedbackMsg');
const elHex = document.getElementById('hexResult');
const elActionArea = document.getElementById('actionArea');
const circles = [
    document.getElementById('c1'),
    document.getElementById('c2'),
    document.getElementById('c3')
];

// --- Initialization ---

async function init() {
    try {
        // Attempt to fetch file lists
        const qRes = await fetch('Q.txt');
        const aRes = await fetch('A.txt');

        if(qRes.ok && aRes.ok) {
            const qText = await qRes.text();
            const aText = await aRes.text();
            // Split by newlines and filter empty strings
            qFiles = qText.split('\n').map(s => s.trim()).filter(s => s);
            aFiles = aText.split('\n').map(s => s.trim()).filter(s => s);
        } else {
            throw new Error("Files not found");
        }
    } catch (e) {
        console.warn("Using fallback mock data (Text files not found)");
        // MOCK DATA for standalone testing
        qFiles = ["sensor_alpha(1).png", "sensor_beta(2).png", "sensor_gamma(3).png", "sensor_delta(4).png"];
        aFiles = ["archive_old(1).jpg", "archive_ref(2).jpg", "archive_bad(5).jpg", "archive_deep(3).jpg"];
    }

    // Start first round
    loadRound(true);
}

// --- Logic ---

// Extracts number from filename, e.g., "star(4).png" -> 4
function getID(filename) {
    if(!filename) return -999;
    const match = filename.match(/\((\d+)\)/);
    return match ? parseInt(match[1]) : -1;
}

function loadRound(fullSwap = true) {
    if(!isGameActive) return;

    if (qFiles.length === 0 || aFiles.length === 0) {
        elFeedback.textContent = "ERR: Database Empty";
        return;
    }

    // Swap Q Image
    if(fullSwap) {
        const randQ = Math.floor(Math.random() * qFiles.length);
        currentQ = qFiles[randQ];
        elImgQ.src = currentQ; // In real repo, might need path prefix
        elImgQ.style.display = "block";
        
        // Mocking image src for test if file doesn't exist
        elImgQ.onerror = () => { elImgQ.src = "https://placehold.co/1080x1920/000000/113344?text=" + currentQ; };
    }

    // Swap A Image (NavLog)
    // 30% chance to force a match if available, to make game playable
    let pickedA;
    const targetID = getID(currentQ);
    const matchingA = aFiles.find(f => getID(f) === targetID);

    if (matchingA && Math.random() < 0.35) {
        pickedA = matchingA;
    } else {
        pickedA = aFiles[Math.floor(Math.random() * aFiles.length)];
    }

    currentA = pickedA;
    elImgA.src = currentA;
    elImgA.style.display = "block";
    elImgA.onerror = () => { elImgA.src = "https://placehold.co/1080x1920/001122/443355?text=" + currentA; };

    elFeedback.textContent = "Awaiting Correlation...";
    elFeedback.style.color = "var(--cyan)";
}

// Update the stability circles
function updateScore(change) {
    if(!isGameActive) return;

    let prevScore = score;
    score += change;
    if (score < 0) score = 0;
    if (score > 3) score = 3;

    // Visual Update
    circles.forEach((c, i) => {
        if (i < score) c.classList.add('lit');
        else c.classList.remove('lit');
    });

    // Win Condition
    if (score === 3 && prevScore !== 3) {
        triggerWin();
    }
}

function triggerWin() {
    isGameActive = false;
    elFeedback.textContent = "STABILIZATION COMPLETE";
    elFeedback.style.color = "var(--good)";
    
    // Create Encode Button
    const btn = document.createElement('button');
    btn.className = "btn-encode";
    btn.textContent = "ENCODE SEQUENCE";
    btn.onclick = generateHex;
    elActionArea.appendChild(btn);

    // Disable game controls
    document.getElementById('btnGen').disabled = true;
    document.getElementById('btnMatch').disabled = true;
    document.getElementById('btnNoMatch').disabled = true;
}

// Generate 3 Hex numbers summing to 27 (0x1B)
function generateHex() {
    const target = 27;
    
    // Random math logic to ensure sum is 27
    // Ensure numbers aren't negative.
    // Try to avoid 0 for aesthetics, but 0 is allowed.
    let n1 = Math.floor(Math.random() * 20) + 1; // 1 to 20
    let rem = target - n1;
    
    // Safety check
    if(rem < 1) { n1 = 15; rem = 12; }

    let n2 = Math.floor(Math.random() * (rem - 1)) + 1;
    let n3 = target - n1 - n2;

    const h1 = "0x" + n1.toString(16).toUpperCase();
    const h2 = "0x" + n2.toString(16).toUpperCase();
    const h3 = "0x" + n3.toString(16).toUpperCase();

    elHex.innerHTML = `${h1} &nbsp; ${h2} &nbsp; ${h3}`;
    elActionArea.innerHTML = ""; // Remove button
    elFeedback.textContent = "COORDINATES LOCKED";
}

// --- Event Listeners ---

document.getElementById('btnGen').addEventListener('click', () => {
    // Only swaps Q, keeps A (or logic could swap both, but user asked to swap "the image" being displayed)
    // To make it easier to find matches, let's just re-roll Q
    loadRound(true); 
});

document.getElementById('btnMatch').addEventListener('click', () => {
    if(!isGameActive) return;
    
    const idQ = getID(currentQ);
    const idA = getID(currentA);

    if (idQ !== -1 && idQ === idA) {
        // Correct Match
        elFeedback.textContent = "MATCH CONFIRMED (+1)";
        elFeedback.style.color = "var(--good)";
        updateScore(1);
        setTimeout(() => { if(isGameActive) loadRound(true); }, 800);
    } else {
        // Incorrect Match
        elFeedback.textContent = "MISMATCH DETECTED (-1)";
        elFeedback.style.color = "var(--bad)";
        updateScore(-1);
        setTimeout(() => { if(isGameActive) loadRound(true); }, 800);
    }
});

document.getElementById('btnNoMatch').addEventListener('click', () => {
    if(!isGameActive) return;

    const idQ = getID(currentQ);
    const idA = getID(currentA);
    
    // User says "No Match". 
    if (idQ !== -1 && idQ === idA) {
        // User was WRONG (There WAS a match)
        elFeedback.textContent = "ERROR: PATTERN IGNORED (-1)";
        elFeedback.style.color = "var(--bad)";
        updateScore(-1);
    } else {
        // User was RIGHT (There was NO match)
        elFeedback.textContent = "SCANNING...";
        // No points, just continue
    }
    
    // In both cases, swap out for random others
    setTimeout(() => { if(isGameActive) loadRound(true); }, 500);
});

// Run
init();

</script>
</body>
</html>
